<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html"><link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html"><link rel="import" href="../bower_components/google-map/google-map.html"><link rel="import" href="../bower_components/google-map/google-map-marker.html"><link rel="import" href="satellite-import.html"></head><body><dom-module id="iss-tracker"><template><style>.data-section{background-color:white;bottom:25px;margin:0 auto;padding:25px;position:absolute;right:25px;z-index:1;}.data-section span{display:block;}google-map{height:100vh;}</style><iron-ajax auto="" url="https://api.wheretheiss.at/v1/satellites/25544?units=miles" handle-as="json" on-response="handlePositionResponse" id="ajaxRequest"></iron-ajax><iron-ajax auto="" url="https://api.wheretheiss.at/v1/satellites/25544/tles" handle-as="json" on-response="handleTLEResponse"></iron-ajax><google-map api-key="AIzaSyD3E1D9b-Z7ekrT3tbhl_dy8DCXuIuDDRc" id="map" zoom="3" latitude="25" longitude="0" map-type="hybrid"><google-map-marker latitude="[[latitude]]" longitude="[[longitude]]" title="ISS (ZARYA)"></google-map-marker></google-map><paper-card class="data-section"><paper-checkbox checked="{{centerMap}}">Center map</paper-checkbox><h2>[[satelliteName]]</h2><span>[[timeString]]</span> <span>Latitude: [[latitudeDisplay]]°</span> <span>Longitude: [[longitudeDisplay]]°</span> <span>Altitude: [[altitude]] [[distanceUnits]]</span> <span>Velocity: [[velocity]] [[speedUnits]]</span> <span>[[visibility]]</span><paper-radio-group selected="miles" id="unitsSelector"><paper-radio-button name="miles">miles</paper-radio-button><paper-radio-button name="kilometers">kilometers</paper-radio-button></paper-radio-group></paper-card></template><script>class IssTracker extends Polymer.Element{static get is(){return'iss-tracker'}constructor(){super(),this.distanceUnits='miles',this.speedUnits='mph',this.horizonCircle=void 0,this.showHorizon=!0,this.centerMap=!0,this.termCircle=void 0}handlePositionResponse(a,b){if(this.updateValues(b.response),this._setISSVisibility(b.response.visibility),this.showHorizon?this.drawHorizon(b.response.footprint):this.hideHorizon(),this.centerMap){const a=this.$.map;a.latitude=this.latitude,a.longitude=this.longitude}this.drawSunriseSunset(b.response.solar_lat,b.response.solar_lon),setTimeout(this.getISSPosition.bind(this),2e3)}updateValues(a){this.latitude=a.latitude,this.longitude=a.longitude,this.latitudeDisplay=this._formatNumber(a.latitude),this.longitudeDisplay=this._formatNumber(a.longitude),this.altitude=this._formatNumber(a.altitude),this.velocity=this._formatNumber(a.velocity)}_formatNumber(a){let b=Math.round(100*a)/100;return b=new Intl.NumberFormat().format(a),b}_setISSVisibility(a){'daylight'===a?this.visibility='The ISS is in daylight':'eclipsed'===a?this.visibility='The ISS is in the Earth\'s shadow':void 0}drawHorizon(a){const b=new google.maps.LatLng(this.latitude,this.longitude);let c=a/2;'miles'===this.distanceUnits?c/=6.2137e-4:c*=1e3,'object'===typeof this.horizonCircle?(this.horizonCircle.setMap(this.$.map.map),this.horizonCircle.setCenter(b),this.horizonCircle.setRadius(c)):this.horizonCircle=new google.maps.Circle({strokeColor:'#FFFFFF',strokeOpacity:0.8,strokeWeight:2,fillColor:'#FFFFFF',fillOpacity:0.3,map:this.$.map.map,center:b,radius:c})}hideHorizon(){'object'===typeof this.horizonCircle&&this.horizonCircle.setMap(null)}drawSunriseSunset(a,b){const c=-1*a,d=b-180;'object'===typeof this.termCircle?this.termCircle.setCenter(new google.maps.LatLng(c,d)):this.termCircle=new google.maps.Circle({strokeColor:'black',strokeOpacity:0.1,strokeWeight:5,fillColor:'black',fillOpacity:0.4,map:this.$.map.map,center:new google.maps.LatLng(c,d),radius:10018790})}getISSPosition(){const a=this.$.unitsSelector,b=this.$.ajaxRequest;this.distanceUnits=a.selected,'miles'===this.distanceUnits?(this.speedUnits='mph',b.url=b.url.replace('kilometers','miles')):(this.speedUnits='kph',b.url=b.url.replace('miles','kilometers')),b.generateRequest()}handleTLEResponse(a,b){const c=new Date,d=satellite.twoline2satrec(b.response.line1,b.response.line2),e=satellite.propagate(d,c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds()),f=e.position,g=satellite.gstime(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds()),h=satellite.eciToGeodetic(f,g),i=h.longitude,j=h.latitude;console.log(satellite.degreesLong(i)),console.log(satellite.degreesLat(j))}showTime(){const a=new Date,b=a.toUTCString();this.timeString=b,setTimeout(this.showTime,500)}}window.customElements.define(IssTracker.is,IssTracker);</script></dom-module></body></html>