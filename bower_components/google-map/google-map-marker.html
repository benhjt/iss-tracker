<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../google-apis/google-maps-api.html"></head><body><dom-module id="google-map-marker"><template><style>:host{display:none;}</style><slot></slot></template><script>(function(){function setupDragHandler_(){if(this.draggable){this.dragHandler_=google.maps.event.addListener(this.marker,"dragend",onDragEnd_.bind(this))}else{google.maps.event.removeListener(this.dragHandler_);this.dragHandler_=null}}function onDragEnd_(e){this.latitude=e.latLng.lat();this.longitude=e.latLng.lng()}Polymer({is:"google-map-marker",properties:{marker:{type:Object,notify:!0},map:{type:Object,observer:"_mapChanged"},info:{type:Object,value:null},clickEvents:{type:Boolean,value:!1,observer:"_clickEventsChanged"},dragEvents:{type:Boolean,value:!1,observer:"_dragEventsChanged"},icon:{type:Object,value:null,observer:"_iconChanged"},mouseEvents:{type:Boolean,value:!1,observer:"_mouseEventsChanged"},zIndex:{type:Number,value:0,observer:"_zIndexChanged"},longitude:{type:Number,value:null,notify:!0},latitude:{type:Number,value:null,notify:!0},label:{type:String,value:null,observer:"_labelChanged"},animation:{type:String,value:null,observer:"_animationChanged"},open:{type:Boolean,value:!1,observer:"_openChanged"}},observers:["_updatePosition(latitude, longitude)"],detached:function(){if(this.marker){google.maps.event.clearInstanceListeners(this.marker);this._listeners={};this.marker.setMap(null)}if(this._contentObserver)this._contentObserver.disconnect()},attached:function(){if(this.marker){this.marker.setMap(this.map)}},_updatePosition:function(){if(this.marker&&null!=this.latitude&&null!=this.longitude){this.marker.setPosition(new google.maps.LatLng(parseFloat(this.latitude),parseFloat(this.longitude)))}},_clickEventsChanged:function(){if(this.map){if(this.clickEvents){this._forwardEvent("click");this._forwardEvent("dblclick");this._forwardEvent("rightclick")}else{this._clearListener("click");this._clearListener("dblclick");this._clearListener("rightclick")}}},_dragEventsChanged:function(){if(this.map){if(this.dragEvents){this._forwardEvent("drag");this._forwardEvent("dragend");this._forwardEvent("dragstart")}else{this._clearListener("drag");this._clearListener("dragend");this._clearListener("dragstart")}}},_mouseEventsChanged:function(){if(this.map){if(this.mouseEvents){this._forwardEvent("mousedown");this._forwardEvent("mousemove");this._forwardEvent("mouseout");this._forwardEvent("mouseover");this._forwardEvent("mouseup")}else{this._clearListener("mousedown");this._clearListener("mousemove");this._clearListener("mouseout");this._clearListener("mouseover");this._clearListener("mouseup")}}},_animationChanged:function(){if(this.marker){this.marker.setAnimation(google.maps.Animation[this.animation])}},_labelChanged:function(){if(this.marker){this.marker.setLabel(this.label)}},_iconChanged:function(){if(this.marker){this.marker.setIcon(this.icon)}},_zIndexChanged:function(){if(this.marker){this.marker.setZIndex(this.zIndex)}},_mapChanged:function(){if(this.marker){this.marker.setMap(null);google.maps.event.clearInstanceListeners(this.marker)}if(this.map&&this.map instanceof google.maps.Map){this._mapReady()}},_contentChanged:function(){if(this._contentObserver)this._contentObserver.disconnect();this._contentObserver=new MutationObserver(this._contentChanged.bind(this));this._contentObserver.observe(this,{childList:!0,subtree:!0});var content=this.innerHTML.trim();if(content){if(!this.info){this.info=new google.maps.InfoWindow;this.openInfoHandler_=google.maps.event.addListener(this.marker,"click",function(){this.open=!0}.bind(this));this.closeInfoHandler_=google.maps.event.addListener(this.info,"closeclick",function(){this.open=!1}.bind(this))}this.info.setContent(content)}else{if(this.info){google.maps.event.removeListener(this.openInfoHandler_);google.maps.event.removeListener(this.closeInfoHandler_);this.info=null}}},_openChanged:function(){if(this.info){if(this.open){this.info.open(this.map,this.marker);this.fire("google-map-marker-open")}else{this.info.close();this.fire("google-map-marker-close")}}},_mapReady:function(){this._listeners={};this.marker=new google.maps.Marker({map:this.map,position:{lat:parseFloat(this.latitude),lng:parseFloat(this.longitude)},title:this.title,animation:google.maps.Animation[this.animation],draggable:this.draggable,visible:!this.hidden,icon:this.icon,label:this.label,zIndex:this.zIndex});this._contentChanged();this._clickEventsChanged();this._dragEventsChanged();this._mouseEventsChanged();this._openChanged();setupDragHandler_.bind(this)()},_clearListener:function(name){if(this._listeners[name]){google.maps.event.removeListener(this._listeners[name]);this._listeners[name]=null}},_forwardEvent:function(name){this._listeners[name]=google.maps.event.addListener(this.marker,name,function(event){this.fire("google-map-marker-"+name,event)}.bind(this))},attributeChanged:function(attrName){if(!this.marker){return}switch(attrName){case"hidden":this.marker.setVisible(!this.hidden);break;case"draggable":this.marker.setDraggable(this.draggable);setupDragHandler_.bind(this)();break;case"title":this.marker.setTitle(this.title);break;}}})})();</script></dom-module></body></html>